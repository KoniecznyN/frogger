(()=>{"use strict";const t=function(t,e,i,n,o){this.x=t,this.y=e,this.w=i,this.h=n,this.color=o};var e,i=(e=function(t,i){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},e(t,i)},function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}),n=function(t){function e(e,i,n,o,r,s,a,h,c){var f=t.call(this,e,i,n,o,r)||this;return f.isAlive=!0,f.direction=s,f.speed=a,f.spritesheet=h,f.carNumber=c,f}return i(e,t),e.prototype.move=function(t){this.destroy(),this.x+=this.direction*this.speed*(t/1e3)},e.prototype.checkCollisions=function(t){return t.x<this.x+this.w&&t.x+t.w>this.x&&t.y<this.y+this.h&&t.y+t.h>this.y},e.prototype.draw=function(t){t.drawImage(this.spritesheet,this.carNumber,100,this.w,this.h,this.x,this.y,this.w,this.h)},e.prototype.destroy=function(){1==this.direction?this.x>=700&&(this.isAlive=!1):this.x<=-this.w&&(this.isAlive=!1)},e}(t);const o=n;var r=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),s=function(t){function e(e,i,n,o,r,s,a){var h=t.call(this,e,i,n,o,r)||this;return h.isDissapearing=!1,h.isHidden=!1,h.isAlive=!0,h.direction=s,h.speed=a,h.isDissapearing=Math.floor(101*Math.random())>60,h}return r(e,t),e.prototype.move=function(t){this.destroy(),this.x+=this.direction*this.speed*(t/1e3)},e.prototype.appear=function(){this.isDissapearing&&(this.color="pink",this.isHidden=!1)},e.prototype.dissapear=function(){this.isDissapearing&&(this.color="red",this.isHidden=!0)},e.prototype.checkCollisions=function(t,e){var i=t.x<this.x+this.w&&t.x+t.w>this.x&&t.y<this.y+this.h&&t.y+t.h>this.y;return!this.isHidden&&(i&&t.follow(e,this.direction,this.speed),i)},e.prototype.draw=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.w,this.h)},e.prototype.destroy=function(){this.x<=-this.w&&(this.isAlive=!1)},e}(t);const a=s;var h=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),c=function(t){function e(e,i,n,o,r,s,a,h){var c=t.call(this,e,i,n,o,r)||this;return c.isAlive=!0,c.direction=s,c.speed=a,c.spritesheet=h,c}return h(e,t),e.prototype.move=function(t){this.destroy(),this.x+=this.direction*this.speed*(t/1e3)},e.prototype.checkCollisions=function(t,e){var i=t.x<this.x+this.w&&t.x+t.w>this.x&&t.y<this.y+this.h&&t.y+t.h>this.y;return i&&t.follow(e,this.direction,this.speed),i},e.prototype.destroy=function(){1==this.direction?this.x>=700&&(this.isAlive=!1):this.x<=-100&&(this.isAlive=!1)},e.prototype.draw=function(t){for(var e=this.w/50,i=0;i<e;i++)0==i?t.drawImage(this.spritesheet,0,150,50,50,this.x,this.y,50,50):i==e-1?t.drawImage(this.spritesheet,100,150,50,50,this.x+50*i,this.y,50,50):t.drawImage(this.spritesheet,50,150,50,50,this.x+50*i,this.y,50,50)},e}(t);const f=c;var u=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),p=function(t){function e(e,i,n,o,r,s,a){var h=t.call(this,e,i,n,o,r)||this;return h.currentAnimation="frog_up",h.frameIndex=0,h.frameTimer=0,h.isAnimating=!1,h.isDead=!1,h.checkCollisions=!0,h.inWater=!1,h.onWood=!1,h.onFlower=!1,h.hitByCar=!1,h.keyDown=function(t){var e=!1;"ArrowUp"===t.key&&(h.y=Math.max(0,h.y-50),h.playAnimation("frog_up"),e=!0),"ArrowDown"===t.key&&(h.y=Math.min(650,h.y+50),h.playAnimation("frog_down"),e=!0),"ArrowLeft"===t.key&&(h.x=Math.max(0,h.x-50),h.playAnimation("frog_left"),e=!0),"ArrowRight"===t.key&&(h.x=Math.min(650,h.x+50),h.playAnimation("frog_right"),e=!0),e&&(h.isAnimating=!0,h.frameIndex=0,h.frameTimer=h.animations[h.currentAnimation].times[0])},h.configureMovement(),h.animations=s,h.spritesheet=a,h}return u(e,t),e.prototype.configureMovement=function(){window.addEventListener("keydown",this.keyDown)},e.prototype.disableMovement=function(){window.removeEventListener("keydown",this.keyDown)},e.prototype.follow=function(t,e,i){this.x+=e*i*(t/1e3),0!=this.x&&650!=this.x||this.die()},e.prototype.playAnimation=function(t){var e=this.animations[t];e&&e.frames&&e.times?(this.currentAnimation=t,this.frameIndex=0,this.frameTimer=e.times[0],this.isAnimating=!0):console.warn('Invalid animation "'.concat(t,'"'))},e.prototype.updateAnimation=function(t){if(this.isAnimating){var e=this.animations[this.currentAnimation];if(e&&(this.frameTimer-=t,this.frameTimer<=0)){if(this.frameIndex++,this.frameIndex>=e.frames.length){if(!e.repeat)return this.frameIndex=e.frames.length-1,void(this.isAnimating=!1);this.frameIndex=0}this.frameTimer=e.times[this.frameIndex]}}},e.prototype.draw=function(t){var e=this.animations[this.currentAnimation];if(e){var i=e.frames[this.frameIndex];t.drawImage(this.spritesheet,i.x,i.y,i.w,i.h,this.x,this.y,this.w,this.h)}},e.prototype.collidesWith=function(t){return this.x<t.x+t.w&&this.x+this.w>t.x&&this.y<t.y+t.h&&this.y+this.h>t.y},e.prototype.playDeathAnimation=function(){var t=this;return new Promise((function(e){t.playAnimation("frog_death"),t.isAnimating=!0,t.frameIndex=0,t.frameTimer=t.animations.frog_death.times[0];var i=t.animations.frog_death.times.reduce((function(t,e){return t+e}),0);setTimeout((function(){t.isAnimating=!1,e()}),i)}))},e.prototype.die=function(){return t=this,e=void 0,n=function(){return function(t,e){var i,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}}(this,(function(t){switch(t.label){case 0:return this.isDead=!0,this.checkCollisions=!1,this.disableMovement(),[4,this.playDeathAnimation()];case 1:return t.sent(),this.x=350,this.y=650,this.checkCollisions=!0,this.isDead=!1,this.configureMovement(),this.playAnimation("frog_up"),[2]}}))},new((i=void 0)||(i=Promise))((function(o,r){function s(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}));var t,e,i,n},e}(t);const l=p;var w=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),y=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return w(e,t),e.prototype.draw=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.w,this.h)},e}(t),d=new y(0,400,700,250,"black"),m=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),v=function(t){function e(e,i,n,o,r){return t.call(this,e,i,n,o,r)||this}return m(e,t),e.prototype.checkCollisions=function(t){return t.x<this.x+this.w&&t.x+t.w>this.x&&t.y<this.y+this.h&&t.y+t.h>this.y},e.prototype.draw=function(t){t.fillStyle=this.color,t.fillRect(this.x,this.y,this.w,this.h)},e}(t);const x=new v(0,100,700,250,"#000047");var g=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),_=function(t){function e(e,i,n,o,r,s){var a=t.call(this,e,i,n,o,r)||this;return a.spritesheet=s,a}return g(e,t),e.prototype.draw=function(t){t.drawImage(this.spritesheet,0,250,this.w,this.h,this.x,this.y,this.w,this.h)},e}(t);const b=_;var S=function(t,e,i,n){return new(i||(i=Promise))((function(o,r){function s(t){try{h(n.next(t))}catch(t){r(t)}}function a(t){try{h(n.throw(t))}catch(t){r(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}h((n=n.apply(t,e||[])).next())}))},A=function(t,e){var i,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(h){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(i=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],n=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,h])}}},I=document.getElementById("canvas"),O=I.getContext("2d");(new(function(){function t(){var t=this;this.frameRate=1e3/60,this.lastFrame=0,this.carSpawnTimer={first:0,second:0,third:0,fourth:0,fifth:0},this.carSpawnIndex={first:0,second:0,third:0,fourth:0,fifth:0},this.cars=[],this.flowersSpawnTimer={first:0,second:0},this.flowersSpawnIndex={first:0,second:0},this.flowers=[],this.woodSpawnTimer={first:0,second:0,third:0,fourth:0,fifth:0},this.woodSpawnIndex={first:0,second:0,third:0,fourth:0,fifth:0},this.woods=[],this.water=x,this.road=d,this.safeZones=[],this.receiveData=function(e){return S(t,void 0,void 0,(function(){return A(this,(function(t){switch(t.label){case 0:return[4,fetch("../data/".concat(e,".json"))];case 1:return[4,t.sent().json()];case 2:return[2,t.sent()]}}))}))},this.loadSpritesheet=function(){return new Promise((function(e){var i=new Image;i.src="../src/frogger_spritesheet.png",i.onload=function(){t.spritesheet=i,e()}}))},this.gameLoop=function(e){var i=0;if(void 0===t.startTime)t.startTime=e;else{var n=Math.round((e-t.startTime)/t.frameRate);for(var o in i=(n-t.lastFrame)*t.frameRate,t.lastFrame=n,t.carSpawnTimer)t.carSpawnTimer[o]+=i;for(var o in t.flowersSpawnTimer)t.flowersSpawnTimer[o]+=i;for(var o in t.woodSpawnTimer)t.woodSpawnTimer[o]+=i}t.spawnCars("first",{x:-100,y:600},50,1,100,t.spritesheet,100),t.spawnCars("second",{x:700,y:550},50,-1,120,t.spritesheet,0),t.spawnCars("third",{x:-100,y:500},50,1,130,t.spritesheet,150),t.spawnCars("fourth",{x:700,y:450},50,-1,100,t.spritesheet,50),t.spawnCars("fifth",{x:700,y:400},100,-1,120,t.spritesheet,200),t.cars=t.cars.filter((function(t){return t.isAlive})),t.spawnFlowers("first",{x:700,y:300},150,150),t.spawnFlowers("second",{x:700,y:150},100,150),t.flowers=t.flowers.filter((function(t){return t.isAlive})),t.spawnWood("first",{x:-150,y:250},150,150),t.spawnWood("second",{x:-350,y:200},350,170),t.spawnWood("third",{x:-200,y:100},200,150),t.woods=t.woods.filter((function(t){return t.isAlive})),O.clearRect(0,0,I.width,I.height),t.checkCollisions(i),t.cars.forEach((function(t){t.move(i)})),t.flowers.forEach((function(t){t.move(i)})),t.woods.forEach((function(t){t.move(i)})),t.frog.updateAnimation(i),t.draw(),requestAnimationFrame(t.gameLoop)}}return t.prototype.init=function(){return S(this,void 0,void 0,(function(){var t,e,i,n;return A(this,(function(o){switch(o.label){case 0:return console.log("start"),t=this,[4,this.receiveData("cars")];case 1:return t.carsData=o.sent(),e=this,[4,this.receiveData("flowers")];case 2:return e.flowersData=o.sent(),i=this,[4,this.receiveData("woods")];case 3:return i.woodsData=o.sent(),n=this,[4,this.receiveData("animations")];case 4:return n.animationsData=o.sent(),[4,this.loadSpritesheet()];case 5:return o.sent(),this.createPlayer(),this.createSafeZones(),this.configureCanvas(),requestAnimationFrame(this.gameLoop),[2]}}))}))},t.prototype.configureCanvas=function(){I.width=700,I.height=700,O.fillStyle="red",O.fillRect(0,0,I.width,I.height)},t.prototype.createPlayer=function(){this.frog=new l(350,650,50,50,"green",this.animationsData,this.spritesheet)},t.prototype.createSafeZones=function(){this.safeZones.push(new b(0,650,700,50,"purple",this.spritesheet)),this.safeZones.push(new b(0,350,700,50,"purple",this.spritesheet))},t.prototype.spawnCars=function(t,e,i,n,r,s,a){this.carSpawnTimer[t]>=this.carsData[t][this.carSpawnIndex[t]]&&(this.cars.push(new o(e.x,e.y,i,50,"white",n,r,s,a)),this.carSpawnTimer[t]-=this.carsData[t][this.carSpawnIndex[t]],this.carSpawnIndex[t]+=1,5==this.carSpawnIndex[t]&&(this.carSpawnIndex[t]=0))},t.prototype.spawnFlowers=function(t,e,i,n){this.flowersSpawnTimer[t]>=this.flowersData[t][this.flowersSpawnIndex[t]]&&(this.flowers.push(new a(e.x,e.y,i,50,"pink",-1,n)),this.flowersSpawnTimer[t]-=this.flowersData[t][this.flowersSpawnIndex[t]],this.flowersSpawnIndex[t]+=1,4==this.flowersSpawnIndex[t]&&(this.flowersSpawnIndex[t]=0),1==this.flowersSpawnIndex[t]?this.flowers.forEach((function(t){t.dissapear()})):this.flowers.forEach((function(t){t.appear()})))},t.prototype.spawnWood=function(t,e,i,n){this.woodSpawnTimer[t]>=this.woodsData[t][this.woodSpawnIndex[t]]&&(this.woods.push(new f(e.x,e.y,i,50,"brown",1,n,this.spritesheet)),this.woodSpawnTimer[t]-=this.woodsData[t][this.woodSpawnIndex[t]],this.woodSpawnIndex[t]+=1,3==this.woodSpawnIndex[t]&&(this.woodSpawnIndex[t]=0))},t.prototype.checkCollisions=function(t){var e=this;if(this.frog.checkCollisions){this.frog.onWood=!1,this.frog.onFlower=!1,this.frog.hitByCar=!1;for(var i=0,n=this.flowers;i<n.length;i++){var o=n[i];if(this.frog.collidesWith(o)){this.frog.onFlower=!0;break}}for(var r=0,s=this.woods;r<s.length;r++){var a=s[r];if(this.frog.collidesWith(a)){this.frog.onWood=!0;break}}for(var h=0,c=this.cars;h<c.length;h++){var f=c[h];if(this.frog.collidesWith(f)){this.frog.hitByCar=!0;break}}if(this.frog.inWater=this.frog.collidesWith(this.water),this.frog.isDead||!this.frog.hitByCar&&(!this.frog.inWater||this.frog.onWood||this.frog.onFlower)||this.frog.die(),this.frog.onWood&&(a=this.woods.find((function(t){return e.frog.collidesWith(t)})),this.frog.follow(t,a.direction,a.speed)),this.frog.onFlower){var u=this.flowers.find((function(t){return e.frog.collidesWith(t)}));this.frog.follow(t,u.direction,u.speed)}}},t.prototype.draw=function(){this.water.draw(O),this.road.draw(O),this.safeZones.forEach((function(t){t.draw(O)})),this.cars.forEach((function(t){t.draw(O)})),this.flowers.forEach((function(t){t.draw(O)})),this.woods.forEach((function(t){t.draw(O)})),this.frog.draw(O)},t}())).init()})();